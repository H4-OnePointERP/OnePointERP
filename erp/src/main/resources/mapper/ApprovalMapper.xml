<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="project.onepoint.erp.approval.mapper.ApprovalMapper">
    <select id="getDashBoard" parameterType="int" resultType="DashBoardRes">
        SELECT
            SUM(CASE WHEN APP_STATUS='미승인' THEN 1 ELSE 0 END) AS "waitingApprovalCount",
            SUM(CASE WHEN APP_STATUS='반려' THEN 1 ELSE 0 END) AS "rejectedApprovalCount",
            (SELECT COUNT(*) FROM APPROVAL WHERE APPROVER = #{id} AND APP_STATUS = '미승인') AS "pendingApprovalCount"
            from APPROVAL
            WHERE EMP_ID = #{id}
        GROUP BY EMP_ID, APPROVER
    </select>

    <insert id="insertApproval" parameterType="ExpenditureReq" useGeneratedKeys="true" keyProperty="APP_SEQ">
        INSERT INTO APPROVAL
        (
        EMP_SEQ,
        APPROVER,
        APP_STATUS,
        APP_TYPE
        )
        VALUES
        (
        #{EMP_SEQ},
        #{APPROVER},
        #{APP_STATUS},
        #{APP_TYPE}
        )
    </insert>
</mapper>
